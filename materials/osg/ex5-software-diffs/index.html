<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://osg-htc.org/virtual-school-pilot-2020/materials/osg/ex5-software-diffs/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Exercise 5 - OSG Virtual School Pilot 2020</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <link href="../../../css/extra.css" rel="stylesheet">
    <link href="../../../css/codehilite.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Grid Exercise 5: Software Differences in the OSG", url: "#_top", children: [
              {title: "Refresher - condor_status", url: "#refresher-condor95status" },
              {title: "Comparing operating systems", url: "#comparing-operating-systems" },
              {title: "Submitting probe jobs", url: "#submitting-probe-jobs" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <h1 id="grid-exercise-5-software-differences-in-the-osg">Grid Exercise 5: Software Differences in the OSG<a class="headerlink" href="#grid-exercise-5-software-differences-in-the-osg" title="Permanent link">&para;</a></h1>
<p>The goal of this exercise is to see the differences in availability of software in the OSG.
At your local cluster, you may be used to having certain versions of software but out on the OSG, it's possible that the
software you need won't even be installed.</p>
<h2 id="refresher-condor95status">Refresher - condor_status<a class="headerlink" href="#refresher-condor95status" title="Permanent link">&para;</a></h2>
<p>The OSG pool, like the local pool you used earlier, is just another HTCondor pool.
This means that the commands you use will be the same and the jobs you submit can have similar payloads but there is one
major difference: the slots are different!
As before, you can use the <code>condor_status</code> command to inspect these differences.</p>
<ol>
<li>Open two terminal windows side-by-side</li>
<li>Log in to <code>learn.chtc.wisc.edu</code> in one window and <code>login04.osgconnect.net</code> in the other</li>
<li>Run <code>condor_status</code> in both windows</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For <code>login04.osgconnect.net</code> you will need to add <code>-pool flock.opensciencegrid.org</code> to your <code>condor_status</code> command.</p>
</div>
<p>Notice any differences?</p>
<h2 id="comparing-operating-systems">Comparing operating systems<a class="headerlink" href="#comparing-operating-systems" title="Permanent link">&para;</a></h2>
<p>To really see differences between slots in the local cluster vs the OSG, you will want to compare the slot ClassAds
between the two pools.
Rather than inspecting the very long ClassAd for each slot, you will look at a specific attribute called <code>OpSysAndVer</code>,
which tells us the operating system version of the server where a slot resides.
An easy way to show this attribute for all slots is by using <code>condor_status</code> in conjunction with the <code>-autoformat</code> (or
<code>-af</code> for short) option.
<code>-autoformat</code> like the <code>-format</code> option you learned about earlier will print out the attributes you're interested
in for each slot but as you probably guessed, it does some automatic formatting for you.
So to show the operating system and version of each slot, run the following command in both of your terminal windows:</p>
<div class="codehilite"><pre><span></span><span class="gp">user@submit-server $</span> condor_status -autoformat OpSysAndVer
</pre></div>


<p>You will see many values with the type of operating system at the front and the version number at the end (i.e. SL6
stands for Scientific Linux 6).
The only problem is that with hundreds or thousands of slots, it's difficult to get a feel for the composition of each
pool from this output.
You can find a count for each operating system by passing the <code>condor_status</code> output into the <code>sort</code> and <code>uniq</code>
commands.
Your command line should look something like this:</p>
<div class="codehilite"><pre><span></span><span class="gp">user@learn $</span> condor_status -autoformat OpSysAndVer <span class="p">|</span> sort <span class="p">|</span> uniq -c
</pre></div>


<p>Can you spot the differences between the two pools now?</p>
<h2 id="submitting-probe-jobs">Submitting probe jobs<a class="headerlink" href="#submitting-probe-jobs" title="Permanent link">&para;</a></h2>
<p>Knowing the type and version of the operating systems is a step in the right direction to knowing what kind of software
will be available on the servers that your jobs land on.
However it still only serves as a proxy to the information that you really want: does the server have the software that
you want?
Does it have the correct version?</p>
<h3 id="software-probe-code">Software probe code<a class="headerlink" href="#software-probe-code" title="Permanent link">&para;</a></h3>
<p>The following shell script probes for software and returns the version if it is installed:</p>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/sh</span>

get_version<span class="o">(){</span>
    <span class="nv">program</span><span class="o">=</span><span class="nv">$1</span>
    <span class="nv">$program</span> --version &gt; /dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
    <span class="nv">double_dash_rc</span><span class="o">=</span><span class="nv">$?</span>
    <span class="nv">$program</span> -version &gt; /dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
    <span class="nv">single_dash_rc</span><span class="o">=</span><span class="nv">$?</span>
    which <span class="nv">$program</span> &gt; /dev/null <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
    <span class="nv">which_rc</span><span class="o">=</span><span class="nv">$?</span>
    <span class="k">if</span> <span class="o">[</span> <span class="nv">$double_dash_rc</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">$program</span> --version <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
    <span class="k">elif</span> <span class="o">[</span> <span class="nv">$single_dash_rc</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nv">$program</span> -version <span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span>
    <span class="k">elif</span> <span class="o">[</span> <span class="nv">$which_rc</span> -eq <span class="m">0</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
        <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$program</span><span class="s2"> installed but could not find version information&quot;</span>
    <span class="k">else</span>
        <span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$program</span><span class="s2"> not installed&quot;</span>
    <span class="k">fi</span>
<span class="o">}</span>

get_version <span class="s1">&#39;R&#39;</span>
get_version <span class="s1">&#39;cmake&#39;</span>
get_version <span class="s1">&#39;python&#39;</span>
get_version <span class="s1">&#39;python3&#39;</span>
</pre></div>


<p>If there's a specific command line program that your research requires, feel free to add it to the script!
For example, if you wanted to test for the existence and version of <code>nslookup</code>, you would add the following to the end
of the script:</p>
<div class="codehilite"><pre><span></span>get_version &#39;nslookup&#39;
</pre></div>


<h3 id="probing-several-servers">Probing several servers<a class="headerlink" href="#probing-several-servers" title="Permanent link">&para;</a></h3>
<p>For this part of the exercise, try creating a submit file without referring to previous exercises!</p>
<ol>
<li>Log in to <code>login04.osgconnect.net</code></li>
<li>Create and change into a new folder for this exercise, e.g. <code>grid-ex5</code></li>
<li>Save the above script as a file named <code>sw_probe.sh</code></li>
<li>Create a submit file that runs <code>sw_probe.sh</code> 100 times and uses macros to write different <code>output</code>, <code>error</code>, and
    <code>log</code> files</li>
<li>Submit your job and wait for the results</li>
</ol>
<p>Will you be able to do your research on the OSG with what's available?
Don't fret if it doesn't look like you can: over the next few days, you'll learn how to make your jobs portable enough
so that they can run anywhere!</p>

  <br>
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../sw/part1-ex1-download/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../sw/part1-ex1-download/" class="btn btn-xs btn-link">
        Exercise 1.1
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../ex4-hardware-diffs/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../ex4-hardware-diffs/" class="btn btn-xs btn-link">
        Exercise 4
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>