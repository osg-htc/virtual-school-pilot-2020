<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://osg-htc.org/virtual-school-pilot-2020/materials/osg/ex4-hardware-diffs/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Exercise 4 - OSG Virtual School Pilot 2020</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <link href="../../../css/extra.css" rel="stylesheet">
    <link href="../../../css/codehilite.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Grid Exercise 4: Hardware Differences in the OSG", url: "#_top", children: [
              {title: "Checking CHTC memory availability", url: "#checking-chtc-memory-availability" },
              {title: "Checking OSG memory availability", url: "#checking-osg-memory-availability" },
              {title: "Analyzing the results", url: "#analyzing-the-results" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <h1 id="grid-exercise-4-hardware-differences-in-the-osg">Grid Exercise 4: Hardware Differences in the OSG<a class="headerlink" href="#grid-exercise-4-hardware-differences-in-the-osg" title="Permanent link">&para;</a></h1>
<p>The goal of this exercise is to compare hardware differences between our local cluster (CHTC here at UW–Madison) and an
OSG glidein pool.
Specifically, we will look at how easy it is to get access to resources in terms of the amount of memory that is
requested.
This will not be a very careful study, but should give you some idea of one way in which the pools are different.</p>
<p>In the first two parts of the exercise, you will submit a bunch of jobs that differ only in how much memory each one
requests;
we call this a <em>parameter sweep</em>, in that we are testing many possible values of a parameter.
We will request memory from 8–64GB, doubling the memory each time.
One set of jobs will be submitted locally, and the other, identical set of jobs will be submitted to OSG.
You will check the queue periodically to see how many jobs have completed and how many are still waiting to run.</p>
<h2 id="checking-chtc-memory-availability">Checking CHTC memory availability<a class="headerlink" href="#checking-chtc-memory-availability" title="Permanent link">&para;</a></h2>
<p>In this first part, you will create the submit file for both the local and OSG jobs, then submit the local set.</p>
<h3 id="yet-another-queue-syntax">Yet another queue syntax<a class="headerlink" href="#yet-another-queue-syntax" title="Permanent link">&para;</a></h3>
<p>Earlier, you learned about the <code>queue</code> statement and some of the different ways it can be invoked to submit
multiple jobs.
Similar to the <code>queue from</code> statement to submit jobs based on lines from a specific file, you can use <code>queue in</code> to
submit jobs based on a list directly from your submit file:</p>
<div class="codehilite"><pre><span></span>queue &lt;# of jobs&gt; &lt;variable&gt; in (
&lt;item 1&gt;
&lt;item 2&gt;
&lt;item 3&gt;
...
)
</pre></div>


<p>For example, to submit 6 total jobs that sleep for <code>5</code>, <code>5</code>, <code>10</code>, <code>10</code>, <code>15</code>, and <code>15</code> seconds, you could write the
following submit file:</p>
<div class="codehilite"><pre><span></span>executable = /bin/sleep

request_cpus = 1
request_memory = 1MB
request_disk = 1MB

queue 2 arguments in (
5
10
15
)
</pre></div>


<p>Try submitting this yourself and check the jobs that end up in the queue with <code>condor_q -nobatch</code>.</p>
<h3 id="create-the-submit-files">Create the submit files<a class="headerlink" href="#create-the-submit-files" title="Permanent link">&para;</a></h3>
<p>To create our parameter sweep, we will create a <strong>new</strong> submit file with multiple queue statements and change the value
of our parameter (<code>request_memory</code>) for each batch of jobs.</p>
<ol>
<li>If not already, log in to <code>learn.chtc.wisc.edu</code></li>
<li>Create and change into a new subdirectory called <code>grid-ex4</code></li>
<li>
<p>Create a submit file that is named <code>sleep.sub</code> that executes the command <code>/bin/sleep 300</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you do not remember all of the submit statements to write this file, or just to go faster, find a similar
submit file from a previous exercise.
Copy the file and rename it here, and make sure the argument to <code>sleep</code> is <code>300</code>.</p>
</div>
</li>
<li>
<p>Use the <code>queue in</code> syntax to submit 10 jobs each for the following memory requests: 8, 16, 32, and 64GB.
    You should have 10 jobs requesting 8GB, 10 jobs requesting 16GB, etc.</p>
</li>
<li>Save the submit file and exit your editor</li>
<li>Submit your jobs</li>
</ol>
<h3 id="monitoring-the-local-jobs">Monitoring the local jobs<a class="headerlink" href="#monitoring-the-local-jobs" title="Permanent link">&para;</a></h3>
<p>Every few minutes, run <code>condor_q</code> and see how your sleep jobs are doing.
To easily see how many jobs of each type you have left, run the following command:</p>
<div class="codehilite"><pre><span></span><span class="gp">user@learn $</span> condor_q &lt;Cluster ID&gt; -af RequestMemory <span class="p">|</span> sort -n <span class="p">|</span> uniq -c
</pre></div>


<p>The numbers in the left column are the number of jobs left of that type and the number on the right is the amount of
memory you requested in MB.
Consider making a little table like the one below to track progress.</p>
<table>
<thead>
<tr>
<th align="left">Memory</th>
<th align="left">Remaining #1</th>
<th align="left">Remaining #2</th>
<th align="left">Remaining #3</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">8 GB</td>
<td align="left">10</td>
<td align="left">6</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">16 GB</td>
<td align="left">10</td>
<td align="left">7</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">32 GB</td>
<td align="left">10</td>
<td align="left">8</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">64 GB</td>
<td align="left">10</td>
<td align="left">9</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>In the meantime, between checking on your local jobs, start the next section – taking a break every few minutes to
record progress on your local jobs.</p>
<h2 id="checking-osg-memory-availability">Checking OSG memory availability<a class="headerlink" href="#checking-osg-memory-availability" title="Permanent link">&para;</a></h2>
<p>For the second part of the exercise, you will just copy over the directory from the <a href="#checking-chtc-memory-availability">above section</a>
on <code>learn.chtc.wisc.edu</code> to <code>login04.osgconnect.net</code> and resubmit your jobs to the OSG.
If you get stuck during the copying process, refer to <a href="../ex2-login-scp/">Grid exercise 2</a>.</p>
<h3 id="monitoring-the-remote-jobs">Monitoring the remote jobs<a class="headerlink" href="#monitoring-the-remote-jobs" title="Permanent link">&para;</a></h3>
<p>As you did in the first part, use <code>condor_q</code> to track how your sleep jobs are doing.
You can move onto the next exercise but keep tracking the status of your jobs.
After you are done with the <a href="../ex5-software-diffs/">next exercise</a>, come back to this exercise,
and move onto analyzing the results.</p>
<h2 id="analyzing-the-results">Analyzing the results<a class="headerlink" href="#analyzing-the-results" title="Permanent link">&para;</a></h2>
<p>Now that you've finished the other exercise, how many jobs have completed locally? How many have completed remotely?</p>
<p>Due to the dynamic nature of the remote pool, the OSG may have noticed the demand for higher memory jobs and leased more
high memory slots for our pool.
That being said, 64GB+ slots are a high-demand, low-availability resource in the OSG so it's unlikely that all of your
64GB+ jobs matched and ran to completion, if any.
On the other hand, the local cluster has a fair number of 64GB+ slots so all your jobs have a high chance of running.</p>

  <br>
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../ex5-software-diffs/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../ex5-software-diffs/" class="btn btn-xs btn-link">
        Exercise 5
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../ex3-submit-osg/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../ex3-submit-osg/" class="btn btn-xs btn-link">
        Exercise 3
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>