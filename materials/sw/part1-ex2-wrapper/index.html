<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <link rel="canonical" href="https://osg-htc.org/virtual-school-pilot-2020/materials/sw/part1-ex2-wrapper/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Exercise 1.2 - OSG Virtual School Pilot 2020</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <link href="../../../css/extra.css" rel="stylesheet">
    <link href="../../../css/codehilite.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Software Exercise 1.2: Writing a Wrapper Script", url: "#_top", children: [
              {title: "Background", url: "#background" },
              {title: "Wrapper Script, part 1", url: "#wrapper-script-part-1" },
              {title: "Submit File Changes", url: "#submit-file-changes" },
              {title: "Wrapper Script, part 2", url: "#wrapper-script-part-2" },
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <style type="text/css"> pre em { font-style: normal; background-color: yellow; } pre strong { font-style: normal; font-weight: bold; color: #008; } </style>

<h1 id="software-exercise-12-writing-a-wrapper-script">Software Exercise 1.2: Writing a Wrapper Script<a class="headerlink" href="#software-exercise-12-writing-a-wrapper-script" title="Permanent link">&para;</a></h1>
<p>In this exercise, you will create a wrapper script to run the same program (<code>blastx</code>) as the <a href="../part1-ex1-download/">previous exercise</a>.</p>
<h2 id="background">Background<a class="headerlink" href="#background" title="Permanent link">&para;</a></h2>
<p>Wrapper scripts are a useful tool for running software that can't be compiled into one piece, needs to be installed with every job, or just for running extra steps.  A wrapper script can either install the software from the source code, or use an already existing software (as in this exercise). Not only does this portability technique work with almost any kind of software that can be locally installed, it also allows for a great deal of control and flexibility for what happens within your job. Once you can write a script to handle your software (and often your data as well), you can submit a large variety of workflows to a distributed computing system like the Open Science Grid.</p>
<p>For this exercise, we will write a wrapper script as an alternate way to run the same job as the previous exercise. </p>
<h2 id="wrapper-script-part-1">Wrapper Script, part 1<a class="headerlink" href="#wrapper-script-part-1" title="Permanent link">&para;</a></h2>
<p>Our wrapper script will be a bash script that runs several commands.</p>
<ol>
<li>
<p>In the same directory as the last exercise (still logged into <code>login04.osgconnect.net</code>) make a file called <code>run_blast.sh</code>. </p>
</li>
<li>
<p>The first line we'll place in the script is the basic command for running blast. Based on our previous submit file, what command needs to go into the script? Once you have an idea, check against the example below:  </p>
<div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>

ncbi-blast-2.10.1+/bin/blastx -db pdbaa/pdbaa -query mouse.fa -out results.txt
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The "header" of <code>#!/bin/bash</code> will tell the computer that this is a bash shell script and can be run in the same way that  you would run individual commands on the command line.</p>
</div>
</li>
</ol>
<h2 id="submit-file-changes">Submit File Changes<a class="headerlink" href="#submit-file-changes" title="Permanent link">&para;</a></h2>
<p>We now need to make some changes to our submit file.</p>
<ol>
<li>
<p>Make a copy of your previous submit file and open it. </p>
</li>
<li>
<p>Since we are now using a wrapper script, that will be our job's executable. Replace the original <code>blastx</code> exeuctable with the name of our wrapper script and comment out the arguments line.  </p>
<div class="codehilite"><pre><span></span>executable = run_blast.sh 
#arguments =
</pre></div>


</li>
<li>
<p>Note that since the <code>blastx</code> program is no longer listed as the executable, it will be need to be included in <code>transfer_input_files</code>. Instead of transferring just that program, we will transfer the original downloaded <code>tar.gz</code> file. To achieve efficiency, we'll also transfer the pdbaa database as the original <code>tar.gz</code> file instead of as the unzipped folder: </p>
<div class="codehilite"><pre><span></span>transfer_input_files = <span style="color:blue">pdbaa.tar.gz</span>, mouse.fa, ncbi-blast-2.10.1+-x64-linux.tar.gz
</pre></div>


</li>
<li>
<p>If you really want to be on top of things, look at the log file for the last exercise, and update your memory and disk requests to be just slightly above the actual "Usage" values in the log. </p>
</li>
</ol>
<p>Before submitting, make sure to make the below additional changes to the wrapper script!</p>
<h2 id="wrapper-script-part-2">Wrapper Script, part 2<a class="headerlink" href="#wrapper-script-part-2" title="Permanent link">&para;</a></h2>
<p>Now that our database and BLAST software are being transferred to the job as <code>tar.gz</code> files, our script needs to accommodate.</p>
<ol>
<li>
<p>Opening your <code>run_blast.sh</code> script, add two commands at the start to un-tar the BLAST and pdbaa <code>tar.gz</code> files. See the <a href="../../../materials/sw/part1-ex1-download">previous exercise</a> if you're not sure what these commands looks like. </p>
</li>
<li>
<p>In order to distinguish this job from our previous job, change the output file name to something besides <code>results.txt</code>. </p>
</li>
<li>
<p>The completed script <code>run_blast.sh</code> should look like this: </p>
<div class="codehilite"><pre><span></span><span class="c1">#/bin/bash</span>

tar -xzf ncbi-blast-2.10.1+-x64-linux.tar.gz 
tar -xzf pdbaa.tar.gz

ncbi-blast-2.10.1+/bin/blastx -db pdbaa/pdbaa -query mouse.fa -out results2.txt
</pre></div>


</li>
<li>
<p>While not strictly necessary, it's a good idea to enable executable permissions on the wrapper script, like so: </p>
<div class="codehilite"><pre><span></span><span class="gp">username@login $</span> chmod u+x run_blast.sh
</pre></div>


</li>
</ol>
<p>Your job is now ready to submit. Submit it using <code>condor_submit</code> and monitor using <code>condor_q</code>.</p>

  <br>
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../part2-ex1-compiling/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../part2-ex1-compiling/" class="btn btn-xs btn-link">
        Exercise 2.1
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../part1-ex1-download/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../part1-ex1-download/" class="btn btn-xs btn-link">
        Exercise 1.1
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="col-md-12 wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>